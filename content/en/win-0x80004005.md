---
title: "エラー 0x80004005: 不明なエラー"
errorText: "エラー 0x80004005: 不明なエラー"
tags: ["Windows", "General", "Permission"]
updatedAt: "2025-11-03T09:11:56.107Z"
lang: "en"
---

## Summary
- Trigger (1 line)  
  "Error 0x80004005: Unspecified error" occurs during file/registry/COM operations or installer execution.  
- Impact (1 line)  
  Operation interruption, installation failure, or inaccessible resources causing deployment or business disruption.  
- Severity (High/Medium/Low, 1-line reason)  
  Medium — often resolved quickly by fixing permissions or locks, but involvement of EDR/GPO can affect deployments and requires prompt resolution.

## Common causes (by priority)
1. Insufficient permissions (ownership/ACL preventing access)  
2. Security product (Defender/EDR/Controlled Folder Access) blocking the action  
3. Blocked file (Zone.Identifier/MOTW) or signing issues  
4. File lock (another process holds a handle)  
5. Execution controls such as AppLocker / SRP / SmartScreen blocking the executable

## 60-second checks (quick verification)
- Launch elevated and retry.  
- Check current ACLs:
```cmd
icacls "C:\Path\To\Folder"
```
- Check your privileges:
```cmd
whoami /groups & whoami /priv
```
- Check Defender block/history and CFA status:
```powershell
Get-MpThreatDetection -ErrorAction SilentlyContinue | Select Timestamp, Action, Resources | Select -First 5
Get-MpPreference | Select EnableControlledFolderAccess
```
- Check TEMP folder permissions:
```cmd
echo %TEMP%
icacls "%TEMP%"
```
- Snapshot GPO effects:
```cmd
gpresult /h "%USERPROFILE%\Desktop\gp.html"
```

## 5-minute resolution (operational flow)
1) Identify target → grant ownership/permissions (GUI or commands as administrator).  
2) Register allowed apps in Controlled Folder Access/EDR and remove MOTW from files.  
   - PowerShell (unblock):
```powershell
Unblock-File -Path "C:\Path\to\installer-or-script.exe"
```
   - GUI: Properties → check "Unblock"  
3) If locked, reboot, boot Safe Mode, or safely terminate the holding process (use resmon to locate handle).

## Permanent mitigations
- Correct ownership and inheritance locally; avoid broad permissions to SYSTEM/Administrators.  
- Maintain Defender/EDR allowlist and exception policies centrally.  
- Implement change request flow for GPO/EDR-managed endpoints.  
- Avoid executing directly from network shares or ZIP; copy to local (e.g., C:\Temp) before running.

## Detailed steps (Windows 10/11)
1. Change settings in GUI (set owner → enable inheritance → assign minimal necessary permissions).  
2. Command examples (run as admin):
```cmd
takeown /F "C:\Path\To\Folder" /R /D Y
icacls "C:\Path\To\Folder" /grant Administrators:F /T
```
Rollback example (restore SYSTEM owner):
```powershell
$p = "C:\Path\To\Folder"
icacls $p /setowner "NT AUTHORITY\SYSTEM" /T
```
Restore excessive permissions / repair inheritance:
```cmd
icacls "C:\Path\To\Folder" /inheritance:e
icacls "C:\Path\To\Folder" /reset
```
3. Defender: check settings and allowed apps  
   - Check status:
```powershell
Get-MpPreference | Select EnableControlledFolderAccess, ControlledFolderAccessAllowedApplications
```
   - Add allowed application:
```powershell
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Path\app.exe"
```
4. If file is locked (how to find)  
   - Run resmon (Win + R → resmon) → CPU → Associated Handles → search path → terminate process or reboot/boot Safe Mode.  
⚠ Warning: Temporarily disabling protections is permitted only during work. After completing tasks, re-enable Defender/EDR and reapply policies via the management console to roll back.

## Common pitfalls (do not do)
- Change ownership broadly on Windows, Program Files, or System32 roots.  
- Grant Everyone:Full on shared folders.

## Recurrence checklist
- Operate as standard user and elevate only when necessary.  
- Execute installers immediately after download to avoid lock or MOTW issues.  
- Document changes and require review/approval.

## Related cases
- Steps when 0x80070005 appears during Windows Update  
- Steps when 0x80070005 appears during Office/Outlook activation  
- Steps when 0x80070005 appears with OneDrive/sync clients

## References
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/icacls  
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/takeown  
- https://learn.microsoft.com/en-us/powershell/module/defender/get-mppreference  
- https://learn.microsoft.com/en-us/powershell/module/defender/add-mppreference  
- https://learn.microsoft.com/en-us/defender-endpoint/enable-controlled-folders  
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult