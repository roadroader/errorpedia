---
title: "エラー 0x80004005: 不明なエラー"
errorText: "エラー 0x80004005: 不明なエラー"
tags: ["Windows", "General", "Permission"]
updatedAt: "2025-11-03T09:11:56.107Z"
lang: "ja"
---

## 要約
- 発生条件（1行）  
  ファイル/レジストリ/COM操作やインストーラー実行中に「エラー 0x80004005: 不明なエラー」が発生する。  
- 影響（1行）  
  操作中断・インストール失敗・アクセス不能により業務停止やデプロイ失敗を招く。  
- 緊急度（高/中/低、理由1行）  
  中 — 多くは権限やロックが原因で短時間解決可能だが、EDRやGPOが絡むと展開に影響するため早期対応が必要。

## よくある原因（優先度順）
1. 権限不足（所有権/ACLによりアクセス拒否）  
2. セキュリティ製品（Defender/EDR/Controlled Folder Access）によるブロック  
3. ブロック付きファイル（Zone.Identifier/MOTW）や署名問題  
4. ファイルロック（別プロセスがハンドル保持している）  
5. AppLocker / ソフトウェア制限ポリシー(SRP) / SmartScreen による実行制御によるブロック

## 60秒で確認（最短手順）
- 管理者で起動 → 再試行  
- 現在のACLを確認：
```cmd
icacls "C:\Path\To\Folder"
```
- 自分の特権を確認：
```cmd
whoami /groups & whoami /priv
```
- Defenderのブロック/履歴とCFA有効状態を確認：
```powershell
Get-MpThreatDetection -ErrorAction SilentlyContinue | Select Timestamp, Action, Resources | Select -First 5
Get-MpPreference | Select EnableControlledFolderAccess
```
- TEMPフォルダーの権限を確認：
```cmd
echo %TEMP%
icacls "%TEMP%"
```
- GPOの影響をスナップショット：
```cmd
gpresult /h "%USERPROFILE%\Desktop\gp.html"
```

## 5分で解決（実務フロー）
1) 対象を特定 → 所有権/権限を付与（GUIまたはコマンドで管理者実行）  
2) 制御されたフォルダーアクセスやEDRの許可登録、MOTW(Zone.Identifier)の解除を実施  
   - PowerShell（ブロック解除）:
```powershell
Unblock-File -Path "C:\Path\to\installer-or-script.exe"
```
   - GUI: 「プロパティ → ブロックの解除」にチェック  
3) ロック中ならリブート/セーフモード/保持プロセスの安全な終了（resmonでハンドルを検索して対象プロセスを特定）

## 根本対策（恒久策）
- 所有権と継承を局所的に是正し、広範なSYSTEM/Administrators付与を避ける。  
- Defender/EDR: 許可アプリと例外ポリシーを中央管理で整備。  
- GPO/EDR配下の申請フローを構築し変更履歴を残す。  
- 共有やZIP直からの実行を避け、必ずローカル（例: C:\Temp）にコピーしてから実行する。

## 詳細手順（Windows 10/11）
1. GUIでの設定変更（所有者→継承→権限を適切に設定）  
2. コマンド例（管理者で実行）
```cmd
takeown /F "C:\Path\To\Folder" /R /D Y
icacls "C:\Path\To\Folder" /grant Administrators:F /T
```
**ロールバック例（SYSTEMに戻す）:**
```powershell
$p = "C:\Path\To\Folder"
icacls $p /setowner "NT AUTHORITY\SYSTEM" /T
```
**付け過ぎた権限を既定に戻す（継承/ACLの修復）**:
```cmd
icacls "C:\Path\To\Folder" /inheritance:e
icacls "C:\Path\To\Folder" /reset
```
3. Defender: 設定と許可アプリ  
   - 状態確認:
```powershell
Get-MpPreference | Select EnableControlledFolderAccess, ControlledFolderAccessAllowedApplications
```
   - 許可追加:
```powershell
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Path\app.exe"
```
4. ファイルがロック中なら（見つけ方）  
   - Win + R → resmon → CPU → 関連付けられたハンドルでパスを検索 → 該当プロセスを終了、または再起動／セーフモードで作業。  
⚠ 注意: 一時無効化は作業中のみ実施すること。作業後は必ずDefender/EDRを元に戻し、ポリシーは管理コンソールで再適用してロールバックする。

## よくある落とし穴（やってはいけない）
- WindowsまたはProgram Files/System32直下への広範な所有権変更を行う。  
- 共有フォルダーにEveryone:フルを付与して運用する。

## 再発防止チェックリスト
- 標準ユーザーで運用し、必要時のみ昇格する。  
- インストーラーはダウンロード直後に実行してロックを避ける。  
- 変更手順を文書化し、レビューと承認を必須化する。

## 関連ケース
- Windows Updateで0x80070005が出るときの手順  
- Office/Outlookの有効化で0x80070005が出るとき  
- OneDrive/同期クライアントで0x80070005が出るとき

## 参考（一次情報）
- https://learn.microsoft.com/ja-jp/windows-server/administration/windows-commands/icacls  
- https://learn.microsoft.com/ja-jp/windows-server/administration/windows-commands/takeown  
- https://learn.microsoft.com/ja-jp/powershell/module/defender/get-mppreference  
- https://learn.microsoft.com/ja-jp/powershell/module/defender/add-mppreference  
- https://learn.microsoft.com/ja-jp/defender-endpoint/enable-controlled-folders  
- https://learn.microsoft.com/ja-jp/windows-server/administration/windows-commands/gpresult