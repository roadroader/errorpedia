---
title: "エラー 0x80070005: アクセスが拒否されました"
errorText: "エラー 0x80070005: アクセスが拒否されました"
tags: ["Windows", "Permission", "Update"]
updatedAt: "2025-11-03T09:11:56.107Z"
lang: "en"
---

## Summary
- Trigger (1 line): Windows denies file/folder operations or installers with error 0x80070005 (Access is denied).
- Impact (1 line): Failed installs, configuration not applied, application execution or updates blocked.
- Urgency (Medium, reason): Medium — can stop work quickly but is usually recoverable with targeted fixes.

## Common causes (priority order)
1. Ownership differs and the current account lacks required ACLs.
2. Defender/EDR controlled folder access (CFA) or antivirus blocking the action.
3. Group Policy or service privileges removing necessary permissions.
4. File locked by another process (installer/sync client holding handles).
5. AppLocker / Software Restriction Policies (SRP) / SmartScreen or other execution controls blocking execution.

## 60-second checks (quick steps)
- Run elevated (Administrator) and retry.
- Check current ACLs:
```cmd
icacls "C:\Path\To\Folder"
```
- Check your privileges:
```cmd
whoami /groups & whoami /priv
```
- Check Defender block history and CFA state:
```powershell
Get-MpThreatDetection -ErrorAction SilentlyContinue | Select Timestamp, Action, Resources | Select -First 5
Get-MpPreference | Select EnableControlledFolderAccess
```
- Check TEMP folder permissions:
```cmd
echo %TEMP%
icacls "%TEMP%"
```
- Snapshot GPO influence:
```cmd
gpresult /h "%USERPROFILE%\Desktop\gp.html"
```

## 5-minute resolution (practical flow)
1) Identify target → assign ownership/permissions (GUI or commands below).
2) Register legitimate installers/tools in Controlled Folder Access or EDR and remove MOTW (Zone.Identifier) if present.
   - PowerShell (unblock):
```powershell
Unblock-File -Path "C:\Path\to\installer-or-script.exe"
```
   - GUI: Properties → check "Unblock" on the file and apply.
3) If locked, reboot / boot to Safe Mode / stop the holding process safely.

## Long-term fixes
- Correct ownership and inheritance locally; avoid broad SYSTEM/Administrators grants.
- Maintain Defender/EDR allowlists for legitimate installers and management tools.
- Establish GPO/EDR exception request workflows and retain audit logs.
- Avoid running from shares or inside ZIPs; copy to local (e.g., C:\Temp) before execution.

## Detailed steps (Windows 10/11)
1. GUI changes
   - Right-click folder → Properties → Security → Advanced → change Owner and verify inheritance.
2. Command examples (run as admin)
```cmd
takeown /F "C:\Path\To\Folder" /R /D Y
icacls "C:\Path\To\Folder" /grant Administrators:F /T
```
   Rollback example (restore to SYSTEM):
```powershell
$p = "C:\Path\To\Folder"
icacls $p /setowner "NT AUTHORITY\SYSTEM" /T
```
   Restore excessive permissions / fix inheritance:
```cmd
icacls "C:\Path\To\Folder" /inheritance:e
icacls "C:\Path\To\Folder" /reset
```
3. Defender: check and allow applications
   - Status check:
```powershell
Get-MpPreference | Select EnableControlledFolderAccess, ControlledFolderAccessAllowedApplications
```
   - Add allowed application:
```powershell
Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Path\app.exe"
```
4. If file is locked (how to find)
   - Run resmon (Win + R → resmon) → CPU tab → Associated Handles → search path → end process or reboot / use Safe Mode.
⚠ Note: If temporarily disabling antivirus/EDR, limit duration and re-enable immediately after task completion. Rollback: re-enable via security settings or restart services to restore protection.

## Common pitfalls (do not)
- Change broad ownership for Windows/Program Files/System32 roots.
- Grant Everyone:Full on shared folders.

## Recurrence checklist
- Operate as standard user and elevate only when needed.
- Execute installers immediately after download to avoid lock/zone issues.
- Document and peer-review change procedures.

## Related cases
- Steps when 0x80070005 appears during Windows Update
- Steps when 0x80070005 appears during Office/Outlook activation
- Steps when 0x80070005 appears with OneDrive/sync clients

## References
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/icacls
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/takeown
- https://learn.microsoft.com/en-us/powershell/module/defender/get-mppreference
- https://learn.microsoft.com/en-us/powershell/module/defender/add-mppreference
- https://learn.microsoft.com/en-us/defender-endpoint/enable-controlled-folders
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult