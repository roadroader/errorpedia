---
title: ".NET 更新プログラムのインストールに失敗 0x80070643"
errorText: ".NET 更新プログラムのインストールに失敗 0x80070643"
tags: ["Windows", ".NET", "Update"]
updatedAt: "2025-11-03T09:11:56.107Z"
lang: "en"
---

## Summary
- Occurrence (1 line)  
  Installer fails with error 0x80070643 during .NET update installation due to access rights, file locks, or execution blocks.
- Impact (1 line)  
  .NET runtime/rollup updates are not applied, preventing security patches and breaking dependent apps.
- Urgency (Medium, 1 line reason)  
  System remains operational but security and compatibility fixes are delayed, so prompt remediation is recommended.

## Common causes (priority order)
1. Missing ownership/ACLs for folders the installer writes to (installer expects SYSTEM or admin).
2. Defender/EDR blocking or Controlled Folder Access preventing write/execute.
3. Installer file marked as blocked (Zone.Identifier/MOTW) or signature issues.
4. File/handle locked by another process (file lock).
5. Execution controls like AppLocker / SRP / SmartScreen blocking the installer.

## 60-second check (quick steps)
- Run as administrator → retry install
- Check current ACLs:
  ```cmd
  icacls "C:\Path\To\Folder"
  ```
- Check your privileges:
  ```cmd
  whoami /groups & whoami /priv
  ```
- Check Defender blocks/history and CFA state:
  ```powershell
  Get-MpThreatDetection -ErrorAction SilentlyContinue | Select Timestamp, Action, Resources | Select -First 5
  Get-MpPreference | Select EnableControlledFolderAccess
  ```
- Check TEMP folder permissions:
  ```cmd
  echo %TEMP%
  icacls "%TEMP%"
  ```
- Snapshot GPO effect:
  ```cmd
  gpresult /h "%USERPROFILE%\Desktop\gp.html"
  ```

## 5-minute fix (operational flow)
1) Identify target → assign ownership/permissions (use GUI or commands only for the specific folder).
2) Whitelist in Controlled Folder Access / EDR, and remove MOTW as needed.  
   - PowerShell (unblock):
     ```powershell
     Unblock-File -Path "C:\Path\to\installer-or-script.exe"
     ```
   - GUI: check “Unblock” in file Properties.
3) If locked, reboot, boot Safe Mode, or safely terminate the owning process (use resmon to find handle).
4) Retry the installation and confirm success.

## Permanent mitigations
- Correct ownership and inheritance locally; avoid broad permission changes.
- Maintain Defender/EDR allowlists and exception policies for installers via centralized deployment.
- Implement approval workflows for GPO/EDR-managed environments.
- Avoid running installers directly from network shares or ZIP; copy locally (e.g., C:\Temp) before executing.

## Detailed steps (Windows 10/11)
1. GUI change: Right-click folder → Properties → Security → Advanced → set owner to an admin or SYSTEM → enable inheritance and grant least-required access.
2. Command examples (run as admin)
   ```cmd
   takeown /F "C:\Path\To\Folder" /R /D Y
   icacls "C:\Path\To\Folder" /grant Administrators:F /T
   ```
   Rollback example (restore to SYSTEM):
   ```powershell
   $p = "C:\Path\To\Folder"
   icacls $p /setowner "NT AUTHORITY\SYSTEM" /T
   ```
   Restore excess permissions to defaults (inheritance/ACL repair):
   ```cmd
   icacls "C:\Path\To\Folder" /inheritance:e
   icacls "C:\Path\To\Folder" /reset
   ```
3. Defender: check and allow applications
   - Check state:
     ```powershell
     Get-MpPreference | Select EnableControlledFolderAccess, ControlledFolderAccessAllowedApplications
     ```
   - Add allow:
     ```powershell
     Add-MpPreference -ControlledFolderAccessAllowedApplications "C:\Path\app.exe"
     ```
4. If file is locked (how to find)
   - Win + R → resmon → CPU tab → Associated Handles → search path → terminate process or reboot/Safe Mode.

⚠ Note: Temporarily disabling Defender/EDR or making broad ACL changes must be limited to the task. Always revert changes after completion (rollback: restore policies and ACLs).

## Common pitfalls (don't do)
- Change ownership broadly on Windows/Program Files/System32 root.
- Grant Everyone:Full on shared folders.
- Operate with EDR disabled permanently.

## Prevention checklist
- Operate as standard user and elevate only when necessary.
- Run installers immediately after download to avoid locking.
- Document and peer-review change procedures.

## Related cases
- Procedures when 0x80070005 appears in Windows Update
- Procedures when 0x80070005 appears during Office/Outlook activation
- Procedures when 0x80070005 appears with OneDrive/sync clients

## References (primary sources)
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/icacls
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/takeown
- https://learn.microsoft.com/en-us/powershell/module/defender/get-mppreference
- https://learn.microsoft.com/en-us/powershell/module/defender/add-mppreference
- https://learn.microsoft.com/en-us/defender-endpoint/enable-controlled-folders
- https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/gpresult