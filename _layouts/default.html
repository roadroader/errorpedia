---
# _layouts/default.html（全面書き直し）
---

<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>{% if page.title %}{{ page.title }} | {{ site.title | default: site.github.repository_name }}{% else %}{{ site.title | default: site.github.repository_name }}{% endif %}</title>

  {% if page.sitemap == false or page.noindex == true %}
  <meta name="robots" content="noindex,nofollow">
  {% endif %}

  <!-- Theme stylesheet (GitHub Pages themes expose /assets/css/style.css) -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">

  <!-- SEO (adds canonical, og, twitter, etc.) -->
  {% seo %}

  <!-- Optional: alternate/hreflang (front matter に alternates: [{lang:'en', url:'/en/.../'}, ...] があれば出力) -->
  {% if page.alternates %}
    {% for alt in page.alternates %}
      <link rel="alternate" hreflang="{{ alt.lang }}" href="{{ alt.url | absolute_url }}">
    {% endfor %}
  {% endif %}

  <style>
    /* ちょい足しの素朴な装飾（テーマの邪魔をしない程度） */
    .site-wrap { max-width: 980px; margin: 0 auto; padding: 1.2rem; }
    .site-header { display:flex; gap:1rem; align-items:center; justify-content:space-between; margin-bottom:1rem; }
    .brand a { text-decoration:none; font-weight:600; }
    .site-nav { display:flex; flex-wrap:wrap; gap:.75rem; }
    .site-nav a { text-decoration:none; padding:.35rem .6rem; border:1px solid #e5e7eb; border-radius:.5rem; }
    .site-nav a:hover { background:#f8fafc; }
    .meta-row { display:flex; gap:.75rem; flex-wrap:wrap; color:#556; font-size:.95rem; margin:.25rem 0 1rem; }
    .tags-row { display:flex; gap:.35rem; flex-wrap:wrap; margin:.25rem 0 1rem; }
    .tag { display:inline-block; background:#f1f5f9; border:1px solid #e5e7eb; padding:.1rem .45rem; border-radius:.4rem; font-size:.85rem; text-decoration:none; }
    .site-footer { margin-top:2rem; padding-top:1rem; border-top:1px solid #eee; color:#667; font-size:.9rem; }
    @media (max-width: 720px){ .site-header { flex-direction:column; align-items:flex-start; gap:.5rem; } }
  </style>
</head>

<body>
  <a href="#main" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to content</a>

  <div class="site-wrap">
    <header class="site-header">
      <div class="brand">
        <a href="{{ '/' | relative_url }}">{{ site.title | default: site.github.repository_name }}</a>
      </div>
      <nav class="site-nav" aria-label="Primary">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="{{ '/about/'   | relative_url }}">About</a>
        <a href="{{ '/privacy/' | relative_url }}">Privacy</a>
        <a href="{{ '/contact/' | relative_url }}">Contact</a>
        <a href="{{ '/tags/'    | relative_url }}">Tags</a>
        <a href="{{ '/search/'  | relative_url }}">Search</a>
      </nav>
    </header>

    <main id="main" role="main">
      <article>
        {% if page.title %}<h1>{{ page.title }}</h1>{% endif %}

        {%- assign _updated = page.updatedAt | default: page.last_modified_at | default: page.date -%}
        <div class="meta-row">
          {% if _updated %}
            <span>Last updated:
              <time datetime="{{ _updated | date_to_xmlschema }}">{{ _updated | date: "%Y-%m-%d" }}</time>
            </span>
          {% endif %}
          {% if page.lang %}
            <span>Lang: {{ page.lang }}</span>
          {% endif %}
        </div>

        {% if page.tags and page.tags.size > 0 %}
          <div class="tags-row" aria-label="Tags">
            <span style="align-self:center;">Tags:</span>
            {% for t in page.tags %}
              <a class="tag" href="{{ '/search/?tags=' | append: t | relative_url }}">{{ t }}</a>
            {% endfor %}
          </div>
        {% endif %}

        <main id="ep-article">
        {{ content }}
        </main>
      </article>
    </main>

    <footer class="site-footer">
      <div>
        © {{ site.time | date: "%Y" }}
        {{ site.author.name | default: site.github.owner_name | default: site.github.repository_owner }}
        · <a href="{{ site.github.repository_url }}">GitHub</a>
        {% if page.path %} · <a href="{{ site.github.repository_url }}/blob/{{ site.github.build_revision }}/{{ page.path }}">View source</a>{% endif %}
      </div>
      <div>
        Build: {{ site.github.build_revision | slice: 0,7 }} · {{ site.time | date: "%Y-%m-%d %H:%M" }}
      </div>
    </footer>
  </div>
  <script>
(function () {
  var root = document.getElementById('ep-article');
  if (!root) return;

  var re = /(https?:\/\/[^\s)<>"']+[^\s.,;:!?)<>"'])/g;

  var walker = document.createTreeWalker(
    root,
    NodeFilter.SHOW_TEXT,
    {
      acceptNode: function (node) {
        if (!node.nodeValue || !re.test(node.nodeValue)) return NodeFilter.FILTER_REJECT;
        var el = node.parentElement;
        if (!el) return NodeFilter.FILTER_REJECT;
        if (el.closest('a, code, pre')) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }
    }
  );

  var nodes = [];
  while (walker.nextNode()) nodes.push(walker.currentNode);

  nodes.forEach(function (textNode) {
    var html = textNode.nodeValue.replace(re, function (url) {
      var safe = url.replace(/"/g, '&quot;');
      return '<a href="' + safe + '" target="_blank" rel="noopener">' + url + '</a>';
    });
    var span = document.createElement('span');
    span.innerHTML = html;
    textNode.parentNode.replaceChild(span, textNode);
    while (span.firstChild) span.parentNode.insertBefore(span.firstChild, span);
    span.parentNode.removeChild(span);
  });
})();
</script>
</body>
</html>
